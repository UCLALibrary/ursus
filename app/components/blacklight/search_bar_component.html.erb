<search>
  <%= form_with url: @url, local: true, method: @method, class: @classes.join(' '), scope: @prefix, role: 'search', class: 'form-group mx-auto mb-0 site-searchbar__search-form site-searchbar__search-form--ursus', **@form_options do |f| %>
    <%= render Blacklight::HiddenSearchStateComponent.new(params: @params) %>
    <% if search_fields.length > 1 %>
      <%= f.label :search_field, scoped_t('search_field.label'), class: 'sr-only visually-hidden' %>
    <% end %>
    <% before_input_groups.each do |input_group| %>
      <%= input_group %>
    <% end %>
    <div class="input-group">
      <%= f.label @query_param, scoped_t('search.label'), class: 'sr-only visually-hidden' %>
      <% if autocomplete_path.present? %>
        <auto-complete src="<%= autocomplete_path %>" for="autocomplete-popup" class="search-autocomplete-wrapper <%= rounded_border_class %>">
          <%= f.search_field @query_param, value: @q, placeholder: scoped_t('search.placeholder'), class: "search-q q form-control site-searchbar__query-field", autofocus: @autofocus, aria: { label: scoped_t('search.label'), autocomplete: 'list', controls: 'autocomplete-popup' }  %>
          <ul id="autocomplete-popup" class="dropdown-menu" role="listbox" aria-label="<%= scoped_t('search.label') %>" hidden></ul>
        </auto-complete>
      <% else %>
        <%= f.search_field @query_param, value: @q, placeholder: scoped_t('search.placeholder'), class: "search-q q form-control site-searchbar__query-field", autofocus: @autofocus, aria: { label: scoped_t('search.label') }  %>
      <% end %>

      <div class="input-group-append site-searchbar__search-icon site-searchbar__search-icon--ursus site-searchbar__search-icon--sinai">
        <button type="submit" class="btn btn-light border-0 search-btn" id="search">
        <svg xmlns="https://www.w3.org/2000/svg" width="19" height="19" viewBox="0 0 16 16"><title>Search</title><g fill="none"><g stroke="#005587"><circle cx="6" cy="6" r="5"></circle><path d="M14 14L10 10" style="stroke-linejoin:round;stroke-width:2;"></path></g></g></svg>
        </button>
      </div>

      <% if search_fields.length > 1 %>
        <%= f.select(:search_field,
                    options_for_select(search_fields, h(@search_field)),
                    {},
                    title: scoped_t('search_field.title'),
                    class: "custom-select site-searchbar__dropdown") %>
      <% elsif search_fields.length == 1 %>
        <%= f.hidden_field :search_field, value: search_fields.first.last %>
      <% end %>
    </div>
  <% end %>

  <% if advanced_search_enabled? %>
    <%= link_to t('blacklight.advanced_search.more_options'), @advanced_search_url, class: 'advanced_search btn btn-secondary'%>
  <% end %>
</search>
